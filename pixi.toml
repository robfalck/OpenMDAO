# How to use this file:
#
# Install the default environment (jax, numba, viz, notebooks)
# pixi install
#
# And then activate the environment
# pixi shell
#
# Or specify a modified environment:
#
# Use the minimal environment
# pixi shell -e minimal
#
# Use the docs environment (with jupyter-book)
# pixi shell -e docs
#
# Use the all environment (everything including tests)
# pixi shell -e all
#
# Use the test environment
# pixi shell -e test
#
# You will then need to install OpenMDAO into the created environment:
# For development mode:
# pixi run install-dev
# For a standard installation
# pixi run install

[project]
name = "openmdao"
description = "OpenMDAO environment"
authors = ["OpenMDAO Team <https://github.com/OpenMDAO>"]
channels = ["conda-forge"]
platforms = ["linux-64", "osx-64", "osx-arm64", "win-64"]

[dependencies]
python = ">=3.10"
pip = "*"
networkx = ">=3.3"
numpy = ">=2.0"
packaging = "*"
requests = "*"
scipy = ">=1.13"

###############################################
# Feature Definitions
###############################################

[feature.docs.dependencies]
ipyparallel = "*"
jupyter-book = ">=1.0.3,<2"
matplotlib = "*"
numpydoc = ">=1.1"
sphinx-sitemap = "*"
idna = ">=3.7"
jinja2 = ">=3.1.4"
tqdm = ">=4.66.3"

[feature.doe.dependencies]
pydoe3 = "*"

[feature.opt.dependencies]
pyoptsparse = ">=2.14.0"
cyipopt = "*"

# JAX is only available on Linux and macOS
[feature.jax.target.linux-64.dependencies]
jax = ">=0.4.0"
jaxlib = ">=0.4.0"

[feature.jax.target.osx-64.dependencies]
jax = ">=0.4.0"
jaxlib = ">=0.4.0"

[feature.jax.target.osx-arm64.dependencies]
jax = ">=0.4.0"
jaxlib = ">=0.4.0"

[feature.mpi.target.linux-64.dependencies]
mpich = "*"
mpi4py = "*"
petsc = "*"
petsc4py = "*"

[feature.mpi.target.osx-64.dependencies]
mpich = "*"
mpi4py = "*"
petsc = "*"
petsc4py = "*"

[feature.mpi.target.osx-arm64.dependencies]
mpich = "*"
mpi4py = "*"
petsc = "*"
petsc4py = "*"

[feature.numba.dependencies]
numba = "*"

[feature.notebooks.dependencies]
ipympl = "*"
notebook = "*"
idna = ">=3.7"

[feature.test.dependencies]
pre-commit = "*"
aiounittest = "*"
num2words = "*"
numpydoc = ">=1.1"
parameterized = "*"
playwright = ">=1.41.0"
pycodestyle = ">=2.4.0"
pydocstyle = ">=2.0.0"
testflo = ">=1.4.15"
websockets = ">8"

[feature.visualization.dependencies]
panel = "*"
bokeh = ">=3.4.0"
colorama = "*"
matplotlib = "*"
rich = "*"

[feature.build.dependencies]
hatchling = "*"

###############################################
# Oldest Versions of dependencies, for testing
###############################################

[feature.deps-oldest.dependencies]
python = "3.11.*"
numpy = "2.0.*"
scipy = "1.13.*"
networkx = "==3.3"

[feature.doe-oldest.dependencies]
pydoe3 = "*"

[feature.opt-oldest.dependencies]
pyoptsparse = "==2.14.0"
cyipopt = "*"

# JAX is only available on Linux and macOS
[feature.jax-oldest.target.linux-64.dependencies]
jax = "0.4.*"
jaxlib = "0.4.*"

[feature.jax-oldest.target.osx-64.dependencies]
jax = "0.4.*"
jaxlib = "0.4.*"

[feature.jax-oldest.target.osx-arm64.dependencies]
jax = "0.4.*"
jaxlib = "0.4.*"

[feature.mpi-oldest.target.linux-64.dependencies]
mpich = "4.2.*"
mpi4py = "4.0.*"
petsc = "3.21.*"
petsc4py = "3.21.*"

[feature.mpi-oldest.target.osx-64.dependencies]
mpich = "4.2.*"
mpi4py = "4.0.*"
petsc = "3.21.*"
petsc4py = "3.21.*"

[feature.mpi-oldest.target.osx-arm64.dependencies]
mpich = "4.2.*"
mpi4py = "4.0.*"
petsc = "3.21.*"
petsc4py = "3.21.*"

[feature.numba-oldest.dependencies]
numba = "*"

[feature.notebooks-oldest.dependencies]
ipympl = "*"
notebook = "*"
idna = "3.7.*"

[feature.test-oldest.dependencies]
pre-commit = "*"
aiounittest = "*"
num2words = "*"
numpydoc = "*"
parameterized = "*"
playwright = "*"
pycodestyle = "*"
pydocstyle = "*"
testflo = "==1.4.15"
websockets = "*"

[feature.visualization-oldest.dependencies]
panel = "*"
bokeh = "3.4.*"
colorama = "*"
matplotlib = "*"
rich = "*"

###############################################
# Latest allowable versions of dependencies
###############################################

[feature.deps-latest.dependencies]
python = "*"
numpy = "*"
scipy = "*"
networkx = "*"

[feature.docs-latest.dependencies]
ipyparallel = "*"
jupyter-book = "<2"
matplotlib = "*"
numpydoc = "*"
sphinx-sitemap = "*"
idna = "*"
jinja2 = "*"
tqdm = "*"

[feature.doe-latest.dependencies]
pydoe3 = "*"

[feature.opt-latest.dependencies]
pyoptsparse = "*"
cyipopt = "*"

# JAX is only available on Linux and macOS
[feature.jax-latest.target.linux-64.dependencies]
jax = "*"
jaxlib = "*"

[feature.jax-latest.target.osx-64.dependencies]
jax = "*"
jaxlib = "*"

[feature.jax-latest.target.osx-arm64.dependencies]
jax = "*"
jaxlib = "*"

[feature.mpi-latest.target.linux-64.dependencies]
mpich = "*"
mpi4py = "*"
petsc = "*"
petsc4py = "*"

[feature.mpi-latest.target.osx-64.dependencies]
mpich = "*"
mpi4py = "*"
petsc = "*"
petsc4py = "*"

[feature.mpi-latest.target.osx-arm64.dependencies]
mpich = "*"
mpi4py = "*"
petsc = "*"
petsc4py = "*"

[feature.numba-latest.dependencies]
numba = "*"

[feature.notebooks-latest.dependencies]
ipympl = "*"
notebook = "*"
idna = "*"

[feature.test-latest.dependencies]
pre-commit = "*"
aiounittest = "*"
num2words = "*"
numpydoc = "*"
parameterized = "*"
playwright = "*"
pycodestyle = "*"
pydocstyle = "*"
testflo = "*"
websockets = "*"

[feature.visualization-latest.dependencies]
panel = "*"
bokeh = "*"
colorama = "*"
matplotlib = "*"
rich = "*"

###############################################
# Environment definitions
###############################################

[environments]

# Default environment - doesn't include dev dependencies
default = { features = ["jax", "numba", "mpi", "notebooks", "opt", "visualization"], solve-group = "default" }

# Minimal environment - only core runtime dependencies
minimal = { features = [], solve-group = "default" }

# Full environment with all features
all = { features = ["docs", "doe", "jax", "mpi", "numba", "notebooks", "opt", "test", "visualization", "build"], solve-group = "default" }

# Full envirironment with oldest allowable versions of all dependencies.
oldest = { features = ["deps-oldest", "docs", "doe-oldest", "jax-oldest", "mpi-oldest", "numba-oldest", "notebooks-oldest", "opt-oldest", "test-oldest", "visualization-oldest", "build"], solve-group = "oldest" }

# Full envirironment with latest versions of all dependencies.
latest = { features = ["deps-latest", "docs-latest", "doe-latest", "jax-latest", "mpi-latest", "numba-latest", "notebooks-latest", "opt-latest", "test-latest", "visualization-latest", "build"], solve-group = "latest" }

###############################################
# Tasks
###############################################

[tasks]

# Installation tasks
install-dev = "pip install -e ."
install = "pip install ."

# Testing tasks
test-all = { cmd = "testflo -n 1 openmdao" }
test-quick = { cmd = "testflo openmdao" }

# Development workflow helpers
clean = "rm -rf build dist *.egg-info .pixi"
update-lock = "pixi update"
