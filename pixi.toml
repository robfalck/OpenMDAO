# OpenMDAO Pixi Environment Configuration
#
# Pixi provides reproducible development environments with both conda and pip packages.
# This is especially useful for dependencies not available on PyPI (like MPI, PETSc).
#
# Quick Start:
#   pixi install --frozen        # Install with exact CI-tested versions
#   pixi shell                   # Activate the default environment
#   pip install -e .             # Install OpenMDAO in development mode
#
#
# Available Environments:
#
# - default: General development environment with JAX, numba, visualization, notebooks, and testing support, but no MPI.
#            Best for most users and everyday development work.
#            Usage: pixi shell  (or pixi shell -e default)
#
# - minimal: Default dependencies only plus testing related dependencies.
#            Used for testing in the absence of dependencies.
#            Usage: pixi shell -e minimal
#
# - all: Comprehensive environment with all optional dependencies except documenation and testing-related ones.
#.       This will give most users the "full" OpenMDAO capability.
#        Usage: pixi shell -e all
#
# - dev: The "all" environment with the addition of documentation and packaging-related dependencies.
#        Usage: pixi shell -e docs
#
# - oldest: Includes oldest supported versions of all dependencies except packaging-related ones.
#           Usage: pixi shell -e oldest
#
# - latest: Includes latest versions of all dependencies except packaging-related ones.
#
#
# Installation:
#   pixi install --frozen -e <environment>    # Install specific environment
#   pixi run -e <environment> <command>       # Run command in environment
#
# For more information: https://pixi.sh

[workspace]
name = "openmdao"
description = "OpenMDAO workspace"
authors = ["OpenMDAO Team <https://github.com/OpenMDAO>"]
channels = ["conda-forge"]
platforms = ["linux-64", "osx-64", "osx-arm64", "win-64"]

[dependencies]
python = ">=3.10"
pip = "*"
networkx = ">=3.3"
numpy = ">=2.0"
packaging = "*"
requests = "*"
scipy = ">=1.13"

###############################################
# Feature Definitions
###############################################

[feature.docs.dependencies]
ipyparallel = "*"
jupyter-book = ">=1.0.3,<2"
matplotlib = "*"
numpydoc = ">=1.1"
sphinx-sitemap = "*"
idna = ">=3.7"
jinja2 = ">=3.1.4"
tqdm = ">=4.66.3"

[feature.doe.dependencies]
pydoe3 = "*"

[feature.opt.dependencies]
pyoptsparse = ">=2.14.0"
cyipopt = "*"

# JAX is only available on Linux and macOS
[feature.jax.target.linux-64.dependencies]
jax = ">=0.4.0"
jaxlib = ">=0.4.0"

[feature.jax.target.osx-64.dependencies]
jax = ">=0.4.0"
jaxlib = ">=0.4.0"

[feature.jax.target.osx-arm64.dependencies]
jax = ">=0.4.0"
jaxlib = ">=0.4.0"

[feature.mpi.target.linux-64.dependencies]
mpich = "*"
mpi4py = "*"
petsc = "*"
petsc4py = "*"

[feature.mpi.target.osx-64.dependencies]
mpich = "*"
mpi4py = "*"
petsc = "*"
petsc4py = "*"

[feature.mpi.target.osx-arm64.dependencies]
mpich = "*"
mpi4py = "*"
petsc = "*"
petsc4py = "*"

[feature.numba.dependencies]
numba = "*"

[feature.notebooks.dependencies]
ipympl = "*"
notebook = "*"
idna = ">=3.7"

[feature.test.dependencies]
pre-commit = "*"
aiounittest = "*"
num2words = "*"
numpydoc = ">=1.1"
parameterized = "*"
playwright = ">=1.41.0"
pycodestyle = ">=2.4.0"
pydocstyle = ">=2.0.0"
testflo = ">=1.4.15"
websockets = ">8"

[feature.visualization.dependencies]
panel = "*"
bokeh = ">=3.4.0"
colorama = "*"
matplotlib = "*"
rich = "*"

[feature.packaging.dependencies]
hatchling = "*"

###############################################
# Oldest Versions of dependencies, for testing
###############################################

[feature.deps-oldest.dependencies]
python = "3.11.*"
numpy = "2.0.*"
scipy = "1.13.*"
networkx = "==3.3"

[feature.doe-oldest.dependencies]
pydoe3 = "*"

[feature.opt-oldest.dependencies]
pyoptsparse = "==2.14.0"
cyipopt = "*"

# JAX is only available on Linux and macOS
[feature.jax-oldest.target.linux-64.dependencies]
jax = "0.4.*"
jaxlib = "0.4.*"

[feature.jax-oldest.target.osx-64.dependencies]
jax = "0.4.*"
jaxlib = "0.4.*"

[feature.jax-oldest.target.osx-arm64.dependencies]
jax = "0.4.*"
jaxlib = "0.4.*"

[feature.mpi-oldest.target.linux-64.dependencies]
mpich = "4.2.*"
mpi4py = "4.0.*"
petsc = "3.21.*"
petsc4py = "3.21.*"

[feature.mpi-oldest.target.osx-64.dependencies]
mpich = "4.2.*"
mpi4py = "4.0.*"
petsc = "3.21.*"
petsc4py = "3.21.*"

[feature.mpi-oldest.target.osx-arm64.dependencies]
mpich = "4.2.*"
mpi4py = "4.0.*"
petsc = "3.21.*"
petsc4py = "3.21.*"

[feature.numba-oldest.dependencies]
numba = "*"

[feature.notebooks-oldest.dependencies]
ipympl = "*"
notebook = "*"
idna = "3.7.*"

[feature.test-oldest.dependencies]
pre-commit = "*"
aiounittest = "*"
num2words = "*"
numpydoc = "*"
parameterized = "*"
playwright = "*"
pycodestyle = "*"
pydocstyle = "*"
testflo = "==1.4.15"
websockets = "*"

[feature.visualization-oldest.dependencies]
panel = "*"
bokeh = "3.4.*"
colorama = "*"
matplotlib = "*"
rich = "*"

###############################################
# Latest allowable versions of dependencies
###############################################

[feature.deps-latest.dependencies]
python = "*"
numpy = "*"
scipy = "*"
networkx = "*"

[feature.docs-latest.dependencies]
ipyparallel = "*"
jupyter-book = "<2"
matplotlib = "*"
numpydoc = "*"
sphinx-sitemap = "*"
idna = "*"
jinja2 = "*"
tqdm = "*"

[feature.doe-latest.dependencies]
pydoe3 = "*"

[feature.opt-latest.dependencies]
pyoptsparse = "*"
cyipopt = "*"

# JAX is only available on Linux and macOS
[feature.jax-latest.target.linux-64.dependencies]
jax = "*"
jaxlib = "*"

[feature.jax-latest.target.osx-64.dependencies]
jax = "*"
jaxlib = "*"

[feature.jax-latest.target.osx-arm64.dependencies]
jax = "*"
jaxlib = "*"

[feature.mpi-latest.target.linux-64.dependencies]
mpich = "*"
mpi4py = "*"
petsc = "*"
petsc4py = "*"

[feature.mpi-latest.target.osx-64.dependencies]
mpich = "*"
mpi4py = "*"
petsc = "*"
petsc4py = "*"

[feature.mpi-latest.target.osx-arm64.dependencies]
mpich = "*"
mpi4py = "*"
petsc = "*"
petsc4py = "*"

[feature.numba-latest.dependencies]
numba = "*"

[feature.notebooks-latest.dependencies]
ipympl = "*"
notebook = "*"
idna = "*"

[feature.test-latest.dependencies]
pre-commit = "*"
aiounittest = "*"
num2words = "*"
numpydoc = "*"
parameterized = "*"
playwright = "*"
pycodestyle = "*"
pydocstyle = "*"
testflo = "*"
websockets = "*"

[feature.visualization-latest.dependencies]
panel = "*"
bokeh = "*"
colorama = "*"
matplotlib = "*"
rich = "*"

###############################################
# Environment definitions
###############################################

[environments]

# Minimal environment - only core runtime dependencies
minimal = { features = ["test"], solve-group = "default" }

# Default environment - doesn't include dev or mpi dependencies
default = { features = ["doe", "jax", "numba", "notebooks", "opt", "visualization", "test"], solve-group = "default" }

# Full environment with all features including mpi and testing support, but not documentation or packaging dependencies
all = { features = ["doe", "jax", "numba", "notebooks", "opt", "visualization", "mpi", "test"], solve-group = "default" }

# Full environment with all features, as well as docs and packaging support.
dev = { features = ["doe", "jax", "numba", "notebooks", "opt", "visualization", "mpi", "test", "docs", "packaging"], solve-group = "default" }

# Full environment with oldest allowable versions of all dependencies.
oldest = { features = ["deps-oldest", "doe-oldest", "jax-oldest", "numba-oldest", "notebooks-oldest", "opt-oldest", "visualization-oldest", "mpi-oldest", "test-oldest", "docs"], solve-group = "oldest" }

# Full envirironment with latest versions of all dependencies.
latest = { features = ["deps-latest", "doe-latest", "jax-latest", "numba-latest", "notebooks-latest", "opt-latest", "visualization-latest", "mpi-latest", "test-latest", "docs-latest"], solve-group = "oldest" }

###############################################
# Tasks
###############################################

[tasks]

# Development workflow helpers
clean = "rm -rf packaging dist *.egg-info .pixi"
